#include <stdio.h>
#include <tchar.h>
#include <string>
#include <conio.h>
#include <iostream>


using namespace std;


void DisplayGrid();
void DisplayInput();
void FillSquare(int row, int col);
void CheckInput();
void CheckStatus();
void Init();


const int ROWS = 3;
const int COLS = 3;
char grid[ROWS][COLS];
int filledSquares = 0;
char input = '  ';
int currentPlayer = 1;


int main()
{
	Init();


	do
	{
		system("cls");
		cout << "Welcome to Noughts and Crosses!" << endl;
		DisplayGrid();
		DisplayInput();
		CheckInput();
		CheckStatus();


	}


	while (toupper(input) != 'F');
}


void DisplayGrid()
{
		cout << grid[0][0] << "|" << grid[0][1] << '|' << grid[0][2] << endl;
		cout << "-" << "|" << "-" << "|" << "-" << endl;
		cout << grid[1][0] << "|" << grid[1][1] << '|' << grid[1][2] << endl;
		cout << "-" << "|" << "-" << "|" << "-" << endl;
		cout << grid[2][0] << "|" << grid[2][1] << '|' << grid[2][2] << endl;
		cout << endl;


}


void DisplayInput()
{
		cout << " Player " << currentPlayer << " it's your go!" << endl;
		cout << "Enter the key as shown below to correspond with the grid!" << endl;
		cout << endl;
		cout << "Q" << "|" << "W" << "|" << "E" << endl;
		cout << "-" << "|" << "-" << "|" << "-" << endl;
		cout << "A" << "|" << "S" << "|" << "D" << endl;
		cout << "-" << "|" << "-" << "|" << "-" << endl;
		cout << "Z" << "|" << "A" << "|" << "C" << endl;


}


void FillSquare(int row, int col)
{
	if (grid[row][col] != ' ')
	{
		cout << "That square is filled, please try again" << endl;
		CheckInput;
	}
	else
	{
		if (currentPlayer == 1)
			grid[row][col] = 'X';
		else
			grid[row][col] = 'O';


		filledSquares++;
	}
}
static void CheckInput()
{
	cin >> input;


	if (cin.fail())
	{
		cout << "Invalid Character, try again!" << endl;
		CheckInput();
	}


	input = toupper(input);


	switch (input)
	{
	case 'Q': FillSquare(0, 0); break;
	case 'W': FillSquare(0, 1); break;
	case 'E': FillSquare(0, 2); break;
	case 'A': FillSquare(1, 0); break;
	case 'S': FillSquare(1, 1); break;
	case 'D': FillSquare(1, 2); break;
	case 'Z': FillSquare(2, 0); break;
	case 'X': FillSquare(2, 1); break;
	case 'C': FillSquare(2, 2); break;


	default:
	{
		cout << "Invalid Character, try again!" << endl;
		CheckInput();
	}
	break;
	}
}
static void CheckStatus()
{
	char xo = 'X';
	if (currentPlayer == 2)
		xo = 'O';


	bool inPlay = true;


	if
		(
			grid[0][0] == xo && grid[0][1] == xo && grid[0][2] == xo ||
			grid[1][0] == xo && grid[1][1] == xo && grid[1][2] == xo ||
			grid[2][0] == xo && grid[2][1] == xo && grid[2][2] == xo ||


			grid[0][0] == xo && grid[1][0] == xo && grid[2][0] == xo ||
			grid[0][1] == xo && grid[1][1] == xo && grid[2][1] == xo ||
			grid[0][2] == xo && grid[1][2] == xo && grid[2][2] == xo ||


			grid[0][0] == xo && grid[1][1] == xo && grid[2][2] == xo ||
			grid[0][2] == xo && grid[1][1] == xo && grid[2][0] == xo
			)


	{
		cout << "Player " << currentPlayer << "wins!" << endl;
		inPlay = false;
	}


	else if (filledSquares == ROWS * COLS)
	{
		cout << "It's a draw!" << endl;
		inPlay = false;
	}


	if (!inPlay)
	{
		DisplayGrid();
		Init;
		cout << "Play again? Any key. F to quit." << endl;
		cin >> input;
	}
	else
	{
		if (currentPlayer == 1)
			currentPlayer = 2;
		else
			currentPlayer = 1;
	}
}


static void Init()
{
	currentPlayer = 1;
	filledSquares = 0;


	for (int row = 0; row < ROWS; row++)
	{
		for (int col = 0; col < COLS; col++)
		{
			grid[row][col] = '  ';
		}
	}
}
